<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qur'an Hifz Premium: Universal</title>
    <style>
        :root {
            --primary-gold: #FFD700;
            --primary-dark: #0b0d0e;
            --surface: #1A1C1E;
            --surface-hover: #24272B;
            --text-main: #FFFFFF;
            --text-dim: #A0A0A0;
            --accent-green: #00FFA3;
            --danger: #FF4D6D;
            --sidebar-width: 280px;
        }

        body {
            margin: 0; padding: 0; background: var(--primary-dark);
            color: var(--text-main); font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex; flex-direction: row; min-height: 100vh;
        }

        /* SIDEBAR (Desktop) */
        .sidebar {
            width: var(--sidebar-width); background: var(--surface);
            border-left: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-direction: column; padding: 20px;
            position: sticky; top: 0; height: 100vh; box-sizing: border-box;
        }
        .sidebar-logo {
            color: var(--primary-gold); font-size: 1.5em; font-weight: bold;
            margin-bottom: 40px; text-align: center; border-bottom: 1px solid rgba(255,215,0,0.1);
            padding-bottom: 20px;
        }
        .sidebar-nav-item {
            padding: 15px 20px; border-radius: 15px; margin-bottom: 10px;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 15px; color: var(--text-dim);
        }
        .sidebar-nav-item.active { background: var(--primary-gold); color: black; font-weight: bold; }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 40px; max-width: 1000px; margin: 0 auto; box-sizing: border-box; }

        .info-card {
            background: var(--surface); border-radius: 24px; padding: 25px;
            margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.03);
        }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 20px; text-align: center; }
        .stat-val { font-size: 2em; color: var(--primary-gold); display: block; }

        .surah-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 10px; max-height: 200px; overflow-y: auto; padding: 15px;
            background: rgba(0,0,0,0.2); border-radius: 15px; margin-top: 10px;
        }

        .test-display {
            background: var(--surface); border-radius: 30px; padding: 40px;
            text-align: center; min-height: 250px; border: 1px solid rgba(255,255,255,0.05);
        }

        .pill-btn {
            background: var(--primary-gold); color: black; border: none;
            padding: 14px 28px; border-radius: 50px; font-weight: bold; cursor: pointer;
        }

        .view-section { display: none; }
        .view-section.active { display: block; }

        /* Bottom Nav (Mobile Only) */
        .bottom-nav { display: none; }

        @media (max-width: 850px) {
            body { flex-direction: column; }
            .sidebar { display: none; }
            .bottom-nav {
                display: flex; position: fixed; bottom: 0; width: 100%;
                background: var(--surface); justify-content: space-around;
                padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.05); z-index: 2000;
            }
            .main-content { padding: 20px 20px 100px; }
        }

        .blurred { filter: blur(12px); cursor: pointer; transition: 0.3s; }
        .blurred:active { filter: blur(0); }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-logo">Ù…ÙØ³Ù’Ù„ÙÙ… ğŸŒ™</div>
        <div class="sidebar-nav-item active" onclick="switchTab('home', this)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="sidebar-nav-item" onclick="switchTab('test', this)">ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø±</div>
        <div class="sidebar-nav-item" onclick="switchTab('read', this)">ğŸ“– Ø§Ù„Ù…ØµØ­Ù</div>
    </aside>

    <main class="main-content">
        <section id="view-home" class="view-section active">
            <h1>Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹</h1>
            <div class="stats-grid">
                <div class="stat-box"><span class="stat-val" id="stat-daily">0</span>Ø¢ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                <div class="stat-box"><span class="stat-val" id="stat-review" style="color:var(--danger)">0</span>Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
            </div>
            <div class="info-card" style="margin-top:20px; background:var(--primary-gold); color:black;">
                <h3>Ø§Ø¨Ø¯Ø£ ÙˆØ±Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸš€</h3>
                <button class="pill-btn" style="background:black; color:white" onclick="switchTab('test')">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
            </div>
        </section>

        <section id="view-test" class="view-section">
            <h2>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸</h2>
            <div class="info-card">
                <div style="display:flex; justify-content:space-between">
                    <strong>Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø©:</strong>
                    <button onclick="toggleSurahs(true)" style="background:none; border:none; color:var(--primary-gold); cursor:pointer;">Ø§Ù„ÙƒÙ„</button>
                </div>
                <div class="surah-grid" id="surahList"></div>
            </div>
            <div class="test-display" id="testArea">
                <div id="cardContent">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ± ÙˆØ§Ø¶ØºØ· Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</div>
            </div>
            <div style="margin-top:20px; text-align:center;" id="testActions">
                <button class="pill-btn" onclick="generateTest()">âœ¨ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
                <button class="pill-btn" style="background:transparent; border:1px solid var(--primary-gold); color:var(--primary-gold)" onclick="reveal()">ğŸ‘ ÙƒØ´Ù</button>
            </div>
            <div id="revealControls" style="display:none; margin-top:20px;">
                <div id="fullReveal" class="blurred" style="font-size:1.8em; margin-bottom:20px;"></div>
                <div style="display:flex; gap:10px;">
                    <button class="pill-btn" style="background:var(--accent-green); flex:1" onclick="handleScore(true)">âœ… Ø£ØªÙ‚Ù†Øª</button>
                    <button class="pill-btn" style="background:var(--danger); color:white; flex:1" onclick="handleScore(false)">âŒ Ù…Ø±Ø§Ø¬Ø¹Ø©</button>
                </div>
            </div>
        </section>

        <section id="view-read" class="view-section">
            <h2>ğŸ“– Ø§Ù„Ù…ØµØ­Ù</h2>
            <select id="jumpMenu" onchange="jumpToSurah()" style="width:100%; padding:15px; background:var(--surface); color:var(--primary-gold); border-radius:15px; border:1px solid var(--primary-gold); margin-bottom:20px;">
                <option value="">ğŸš€ Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø³ÙˆØ±Ø©...</option>
            </select>
            <div id="mushaf-content"></div>
        </section>
    </main>

    <nav class="bottom-nav">
        <div onclick="switchTab('home')">ğŸ </div>
        <div onclick="switchTab('test')">ğŸ¯</div>
        <div onclick="switchTab('read')">ğŸ“–</div>
    </nav>

    <script>
        let quran = [];
        let currentIdx = -1;
        let reviewList = JSON.parse(localStorage.getItem('hifz_reviews')) || [];
        let dailyCount = parseInt(localStorage.getItem('hifz_daily')) || 0;

        // CRITICAL FIX: Ensure initialization happens AFTER data is fetched
        fetch('fullquran_fixed.json')
            .then(response => response.json())
            .then(data => {
                quran = data;
                console.log("Quran data loaded, count:", quran.length);
                initApp();
            })
            .catch(err => {
                console.error("Error loading JSON:", err);
                document.getElementById('cardContent').innerText = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ fullquran_fixed.json";
            });

        function initApp() {
            updateStats();
            
            // 1. Get unique surah names
            const names = [...new Set(quran.map(x => x.surah))];
            
            // 2. Populate Surah Checkboxes
            const listEl = document.getElementById('surahList');
            if(listEl) {
                listEl.innerHTML = names.map(n => `
                    <label style="display:flex; align-items:center; gap:5px; font-size:0.85em;">
                        <input type="checkbox" checked value="${n}"> ${n}
                    </label>
                `).join('');
            }

            // 3. Populate Jump Menu
            const jumpEl = document.getElementById('jumpMenu');
            if(jumpEl) {
                names.forEach(n => {
                    let opt = document.createElement('option');
                    opt.value = n; opt.textContent = n;
                    jumpEl.appendChild(opt);
                });
            }

            // 4. Build Mushaf
            const mushafEl = document.getElementById('mushaf-content');
            if(mushafEl) {
                mushafEl.innerHTML = quran.map(a => `
                    <div class="info-card" id="anchor-${a.surah}">
                        <div style="color:var(--primary-gold); font-size:0.8em;">${a.surah} â€¢ ${a.ayah_num}</div>
                        <div style="font-size:1.4em; line-height:1.8;">${a.full}</div>
                    </div>
                `).join('');
            }
        }

        function switchTab(target, el) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + target).classList.add('active');
            document.querySelectorAll('.sidebar-nav-item').forEach(i => i.classList.remove('active'));
            if(el) el.classList.add('active');
        }

        function generateTest() {
            const selected = Array.from(document.querySelectorAll('#surahList input:checked')).map(i => i.value);
            if(!selected.length) return alert("Ø§Ø®ØªØ± Ø³ÙˆØ±Ø©");

            const pool = quran.map((v, i) => selected.includes(v.surah) ? i : -1).filter(i => i !== -1);
            currentIdx = pool[Math.floor(Math.random() * pool.length)];
            const ayah = quran[currentIdx];

            document.getElementById('cardContent').innerHTML = `
                <div style="color:var(--primary-gold); font-weight:bold;">${ayah.surah} â€¢ Ø¢ÙŠØ© ${ayah.ayah_num}</div>
                <div style="font-size:1.8em; margin-top:20px;">${ayah.start} ...</div>
            `;
            document.getElementById('revealControls').style.display = 'none';
            document.getElementById('testActions').style.display = 'block';
        }

        function reveal() {
            if(currentIdx === -1) return;
            const rev = document.getElementById('fullReveal');
            rev.textContent = quran[currentIdx].full;
            rev.classList.add('blurred');
            document.getElementById('revealControls').style.display = 'block';
            document.getElementById('testActions').style.display = 'none';
        }

        function handleScore(success) {
            if(!success) {
                if(!reviewList.includes(currentIdx)) reviewList.push(currentIdx);
            } else {
                reviewList = reviewList.filter(i => i !== currentIdx);
                dailyCount++;
            }
            localStorage.setItem('hifz_reviews', JSON.stringify(reviewList));
            localStorage.setItem('hifz_daily', dailyCount);
            updateStats();
            generateTest();
        }

        function updateStats() {
            document.getElementById('stat-daily').innerText = dailyCount;
            document.getElementById('stat-review').innerText = reviewList.length;
        }

        function jumpToSurah() {
            const s = document.getElementById('jumpMenu').value;
            const target = document.getElementById(`anchor-${s}`);
            if(target) target.scrollIntoView({ behavior: 'smooth' });
        }

        function toggleSurahs(val) {
            document.querySelectorAll('#surahList input').forEach(i => i.checked = val);
        }
    </script>
</body>
</html>




