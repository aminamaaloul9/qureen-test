<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Qur'an Hifz Master</title>
    <style>
        :root {
            --primary: #00ffa3;
            --accent: #ffd700;
            --bg: #0b1311;
            --surface: #16211e;
            --text: #e0e0e0;
        }

        body {
            margin: 0; padding: 0; background: var(--bg); color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        /* Tab Navigation */
        .tabs {
            display: flex; background: var(--surface); position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid #243531;
        }
        .tab {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            font-weight: bold; opacity: 0.6; transition: 0.3s;
        }
        .tab.active { opacity: 1; color: var(--primary); border-bottom: 3px solid var(--primary); }

        .container { width: 92%; max-width: 600px; margin: auto; padding: 20px 0 100px; }

        /* Settings Card */
        .card-settings {
            background: var(--surface); border-radius: 20px; padding: 15px; margin-bottom: 20px;
        }
        .surah-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            max-height: 150px; overflow-y: auto; margin: 10px 0;
        }
        .surah-item {
            background: #1d2b27; padding: 8px; border-radius: 8px;
            display: flex; align-items: center; font-size: 0.8em;
        }

        /* Mushaf Mode */
        #mushaf-view { display: none; background: var(--surface); border-radius: 20px; padding: 20px; }
        .mushaf-ayah { margin-bottom: 20px; border-bottom: 1px solid #243531; padding-bottom: 10px; }
        .mushaf-meta { color: var(--primary); font-size: 0.8em; }
        .mushaf-text { font-size: 1.4em; line-height: 1.8; margin-top: 5px; }

        /* Test Card */
        .test-card {
            background: var(--surface); border-radius: 24px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #243531;
        }
        .ayah-text { font-size: 1.6em; line-height: 1.7; margin: 15px 0; }
        .context-box { 
            background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px;
            font-size: 0.9em; margin: 5px 0; color: #aaa;
        }

        /* Buttons */
        .btn {
            padding: 14px; border-radius: 14px; border: none; font-weight: bold;
            cursor: pointer; width: 100%; margin-top: 10px;
        }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-small { padding: 5px 10px; font-size: 0.7em; margin-right: 5px; }

        .action-group { margin-top: 20px; }
        .search-box {
            width: 100%; padding: 10px; border-radius: 10px; border: none;
            background: #0b1311; color: white; box-sizing: border-box;
        }
    </style>
</head>
<body>

<div class="tabs">
    <div class="tab active" onclick="switchTab('test')">ğŸ¯ Ø¥Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸</div>
    <div class="tab" onclick="switchTab('read')">ğŸ“– Ø§Ù„Ù…ØµØ­Ù</div>
</div>

<div class="container">
    <div id="test-view">
        <div class="card-settings">
            <input type="text" class="search-box" id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø©..." oninput="filterSurahs()">
            <div class="surah-grid" id="surahList"></div>
            <div>
                <button class="btn btn-outline btn-small" onclick="toggleSurahs(true)">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                <button class="btn btn-outline btn-small" onclick="toggleSurahs(false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
            </div>
        </div>

        <div class="test-card" id="testCard">
            <div id="cardContent" style="text-align:center; opacity:0.5;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†</div>
        </div>

        <div class="action-group">
            <button class="btn btn-primary" onclick="generateTest()">ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn btn-outline" onclick="reveal()">ğŸ‘ ÙƒØ´Ù Ø§Ù„Ø¢ÙŠØ©</button>
            
            <div id="revealControls" style="display:none; margin-top:15px;">
                <div id="prevAyah" class="context-box"></div>
                <div id="nextAyah" class="context-box"></div>
                <button class="btn btn-outline" style="color:var(--accent); border-color:var(--accent)" onclick="playAudio()">ğŸ”Š Ø§Ø³ØªÙ…Ø§Ø¹ Ø¨ØµÙˆØª Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</button>
            </div>
        </div>
    </div>

    <div id="mushaf-view">
        <h3 style="color:var(--primary)">Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
        <div id="mushaf-content"></div>
    </div>
</div>

<script>
    let quran = [];
    let currentIdx = -1;

    fetch('quran_fixed.json').then(r => r.json()).then(data => {
        quran = data;
        loadApp();
    });

    function loadApp() {
        // Build Surah selection list
        const names = [...new Set(quran.map(x => x.surah))];
        document.getElementById('surahList').innerHTML = names.map(n => `
            <label class="surah-item"><input type="checkbox" checked value="${n}"> <span>${n}</span></label>
        `).join('');

        // Build Mushaf Content
        document.getElementById('mushaf-content').innerHTML = quran.map((a, i) => `
            <div class="mushaf-ayah">
                <div class="mushaf-meta">${a.surah} | Ø¢ÙŠØ© ${a.ayah_num}</div>
                <div class="mushaf-text">${a.full}</div>
            </div>
        `).join('');
    }

    function switchTab(mode) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('test-view').style.display = (mode === 'test') ? 'block' : 'none';
        document.getElementById('mushaf-view').style.display = (mode === 'read') ? 'block' : 'none';
    }

    function toggleSurahs(val) {
        document.querySelectorAll('#surahList input').forEach(i => i.checked = val);
    }

    function filterSurahs() {
        const q = document.getElementById('search').value;
        document.querySelectorAll('.surah-item').forEach(el => {
            el.style.display = el.textContent.includes(q) ? 'flex' : 'none';
        });
    }

    function generateTest() {
        const selected = Array.from(document.querySelectorAll('#surahList input:checked')).map(i => i.value);
        if(!selected.length) return alert("Ø§Ø®ØªØ± Ø³ÙˆØ±Ø©");

        const pool = quran.map((v, i) => selected.includes(v.surah) ? i : -1).filter(i => i !== -1);
        currentIdx = pool[Math.floor(Math.random() * pool.length)];
        const ayah = quran[currentIdx];

        document.getElementById('cardContent').innerHTML = `
            <div style="color:var(--primary); font-size:0.9em;">Ø³ÙˆØ±Ø© ${ayah.surah} â€¢ Ø¢ÙŠØ© ${ayah.ayah_num}</div>
            <div class="ayah-text">${ayah.start} ...</div>
            <div id="fullReveal" style="display:none; border-top:1px solid #243531; padding-top:10px;">${ayah.full}</div>
        `;
        document.getElementById('revealControls').style.display = 'none';
    }

    function reveal() {
        if(currentIdx === -1) return;
        document.getElementById('fullReveal').style.display = 'block';
        document.getElementById('revealControls').style.display = 'block';

        // Context Logic
        const prev = quran[currentIdx - 1];
        const next = quran[currentIdx + 1];
        
        document.getElementById('prevAyah').innerHTML = prev ? `<b>Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</b> ${prev.full}` : "Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù";
        document.getElementById('nextAyah').innerHTML = next ? `<b>Ø§Ù„ØªØ§Ù„ÙŠØ©:</b> ${next.full}` : "Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù";
    }

    function playAudio() {
        const audio = new Audio(`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${currentIdx + 1}.mp3`);
        audio.play();
    }
</script>

</body>
</html>
