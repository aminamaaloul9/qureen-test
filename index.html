<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qur'an Memorization Trainer</title>
    <style>
        :root {
            --primary: #00ffcc;
            --bg-gradient: linear-gradient(135deg, #021b14, #052c20);
            --card-bg: rgba(255, 255, 255, 0.08);
        }

        body {
            margin: 0;
            padding: 20px;
            background: var(--bg-gradient);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 700px;
            text-align: center;
        }

        header h1 {
            color: var(--primary);
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.3);
            margin-bottom: 5px;
        }

        /* Settings Area */
        .settings-panel {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }

        .surah-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .surah-item {
            font-size: 0.85em;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        /* The Display Card */
        .card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 40px 30px;
            margin: 20px 0;
            min-height: 150px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .ayah-info { color: var(--primary); font-weight: bold; margin-bottom: 15px; display: block; }
        .ayah-prompt { font-size: 1.6em; line-height: 1.6; }
        .ayah-full { margin-top: 20px; color: #ced4da; font-size: 1.4em; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.2); }

        /* Buttons */
        .btn-group { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        button {
            padding: 15px 35px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1em;
        }

        .btn-main { background: var(--primary); color: #021b14; }
        .btn-secondary { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 255, 204, 0.4); }
        button:active { transform: translateY(0); }

        .loading-overlay { font-size: 1.2em; color: var(--primary); }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>ğŸ“– Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø­ÙØ¸</h1>
        <p>Ø§Ø®ØªØ¨Ø± Ù†ÙØ³Ùƒ ÙÙŠ Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</p>
    </header>

    <div class="settings-panel" id="settings">
        <strong>Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…Ø´Ù…ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong>
        <div class="surah-grid" id="surahList">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±...</div>
        <div style="margin-top:10px;">
            <button class="btn-secondary" style="padding: 5px 15px; font-size: 0.8em;" onclick="toggleAll(true)">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
            <button class="btn-secondary" style="padding: 5px 15px; font-size: 0.8em;" onclick="toggleAll(false)">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
        </div>
    </div>

    <div class="card" id="displayArea">
        <div class="loading-overlay">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <div class="btn-group">
        <button class="btn-main" onclick="generateTest()">ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
        <button class="btn-secondary" onclick="revealAyah()">ğŸ‘ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¢ÙŠØ©</button>
    </div>
</div>

<script>
    let quranData = [];
    let currentAyah = null;

    // 1. Fetch the Data
    fetch('fullquran_fixed.json')
        .then(res => res.json())
        .then(data => {
            quranData = data;
            initApp();
        })
        .catch(err => {
            document.getElementById('displayArea').innerHTML = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù JSON. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡ Ø¨Ø¬Ø§Ù†Ø¨ Ù…Ù„Ù Ø§Ù„Ù€ HTML.";
        });

    function initApp() {
        buildSurahList();
        document.getElementById('displayArea').innerHTML = "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ± Ø«Ù… Ø§Ø¶ØºØ· 'Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯'.";
    }

    // 2. Build the Surah selection grid
    function buildSurahList() {
        const container = document.getElementById('surahList');
        const uniqueSurahs = [...new Set(quranData.map(item => item.surah))];
        
        container.innerHTML = uniqueSurahs.map(name => `
            <label class="surah-item">
                <input type="checkbox" checked value="${name}">
                <span style="margin-right:8px">${name}</span>
            </label>
        `).join('');
    }

    function toggleAll(status) {
        document.querySelectorAll('#surahList input').forEach(cb => cb.checked = status);
    }

    // 3. Logic for random selection
    function generateTest() {
        const activeSurahs = Array.from(document.querySelectorAll('#surahList input:checked')).map(cb => cb.value);
        
        if (activeSurahs.length === 0) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
            return;
        }

        const pool = quranData.filter(item => activeSurahs.includes(item.surah));
        currentAyah = pool[Math.floor(Math.random() * pool.length)];

        document.getElementById('displayArea').innerHTML = `
            <span class="ayah-info">Ø³ÙˆØ±Ø© ${currentAyah.surah} | Ø¢ÙŠØ© ${currentAyah.ayah_num}</span>
            <div class="ayah-prompt">${currentAyah.start} ...</div>
            <div id="revealSection"></div>
        `;
    }

    function revealAyah() {
        if (!currentAyah) return;
        const revealSection = document.getElementById('revealSection');
        revealSection.innerHTML = `<div class="ayah-full">${currentAyah.full}</div>`;
    }
</script>

</body>
</html>